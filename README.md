# astro-html-minifier-next

> Minify [Astro][astro] HTML assets using [html-minifier-next][html-minifier-next]!

- **Improves page speed** - Reduces the size of HTML assets by removing everything unnecessary.
- **Highly configurable** - All options from [html-minifier-next][html-minifier-next] are supported and can be customized.
- **Fast** - Runs the minification of all assets with (limited) concurrency.

[![Version badge](https://img.shields.io/npm/v/astro-html-minifier-next?style=for-the-badge&label=Version&labelColor=2a2d35&color=f2ebf4)][latest-release]
[![NPM downloads badge](https://img.shields.io/npm/d18m/astro-html-minifier-next?style=for-the-badge&label=NPM%20Downloads&labelColor=2a2d35&color=e13fa0&cacheSeconds=86400)][package-on-npm]
[![JSR score badge](https://jsr.io/badges/@jonasgeiler/astro-html-minifier-next/score?style=for-the-badge&label=Score&logoColor=fff&labelColor=2a2d35&color=f2ebf4&cacheSeconds=86400)][package-on-jsr]
[![Minified size (gzip) badge](https://img.shields.io/bundlejs/size/astro-html-minifier-next?style=for-the-badge&labelColor=2a2d35&color=e13fa0&cacheSeconds=86400)][package-on-bundlejs]

```typescript
import { defineConfig } from "astro/config";
import htmlMinifier from "astro-html-minifier-next";

export default defineConfig({
  integrations: [
    htmlMinifier({
      /* html-minifier-next options */
      // TODO: Put optimized options here.
      caseSensitive: false,
      collapseBooleanAttributes: true,
      collapseInlineTagWhitespace: true,
      collapseWhitespace: true,
      conservativeCollapse: false,
      continueOnParseError: false,
      decodeEntities: true,
      html5: true,
      includeAutoGeneratedTags: true,
      keepClosingSlash: false,
      minifyCSS: { level: 2 },
      minifyJS: true,
      minifyURLs: false,
      noNewlinesBeforeTagClose: false,
      preserveLineBreaks: false,
      preventAttributesEscaping: false,
      processConditionalComments: false,
      removeAttributeQuotes: true,
      removeComments: true,
      removeEmptyAttributes: true,
      removeEmptyElements: false,
      removeOptionalTags: true,
      removeRedundantAttributes: true,
      removeScriptTypeAttributes: true,
      removeStyleLinkTypeAttributes: true,
      removeTagWhitespace: false,
      sortAttributes: false,
      sortClassName: false,
      useShortDoctype: true,
    }),
  ],
});
```

## Installation

Add the integration to your Astro project using the `astro add` command.  
This will install the adapter and make the appropriate changes to your
`astro.config.mjs`/`astro.config.ts` file in one step:
```bash
npx astro add astro-html-minifier-next
```
If you prefer to install the integration manually instead, complete the
following two steps:
1. Install the integration to your project’s dependencies using your preferred
   package manager.  
   If you’re using npm or aren’t sure, run this in the terminal:
   ```bash
   npm install --save-dev astro-html-minifier-next
   ```
   Or, if you're using Deno, run this in the terminal:
   ```bash
   deno add jsr:@jonasgeiler/astro-html-minifier-next
   ```
2. Add the integration to your `astro.config.mjs`/`astro.config.ts` file:
   ```typescript
   import { defineConfig } from "astro/config";
   
   // ADD THE FOLLOWING LINE:
   import htmlMinifier from "astro-html-minifier-next";

   export default defineConfig({
     // ...
     integrations: [
        // ...
   
        // ADD THE FOLLOWING LINE:
        htmlMinifier({ /* Your html-minifier-next options here. */ }),
     ],
     // ...
   });
   ```

## Usage

Once installed, the integration will automatically minify all HTML assets
generated by Astro during the build process using the provided
[html-minifier-next][html-minifier-next] options.

> [!TIP]
> I recommend setting `minifyCSS` to `{ level: 2 }`, and not `true` like
> most people do. This will apply more advanced optimizations to inline CSS,
> which can lead to significantly smaller HTML files.

### Options

You can find a quick reference of all available options on the
[html-minifier-next npm page][html-minifier-next-options].

## Credits

This integration wouldn't be possible without the awesome work of
[Juriy Zaytsev (@kangax)][@kangax] ([html-minifier][html-minifier]),
[the Terser team][@terser] ([html-minifier-terser][html-minifier-terser]), and
of course [Jens Oliver Meiert (@j9t)][@j9t] ([html-minifier-next][html-minifier-next]).

[astro]: https://astro.build/
[html-minifier-next]: https://www.npmjs.com/package/html-minifier-next
[html-minifier-next-options]: https://www.npmjs.com/package/html-minifier-next#user-content-options-quick-reference
[latest-release]: https://github.com/jonasgeiler/astro-html-minifier-next/releases/latest
[package-on-bundlejs]: https://bundlejs.com/?q=astro-html-minifier-next
[package-on-jsr]: https://jsr.io/@jonasgeiler/astro-html-minifier-next
[package-on-npm]: https://www.npmjs.com/package/astro-html-minifier-next
[@kangax]: https://github.com/kangax
[html-minifier]: https://github.com/kangax/html-minifier
[@terser]: https://github.com/terser
[html-minifier-terser]: https://github.com/terser/html-minifier-terser
[@j9t]: https://github.com/j9t
