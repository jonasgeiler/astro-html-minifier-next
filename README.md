# astro-html-minifier-next

> Minify [Astro][astro] HTML assets using [html-minifier-next][html-minifier-next]!

- **Improves page speed** - Reduces the size of HTML assets by removing everything unnecessary.
- **Highly configurable** - All options from [html-minifier-next][html-minifier-next] are supported and can be customized.
- **Fast** - Runs the minification of all assets with (limited) concurrency and [Lightning CSS][lightningcss].

[![Version badge](https://img.shields.io/npm/v/astro-html-minifier-next?style=for-the-badge&label=Version&labelColor=2a2d35&color=f2ebf4)][latest-release]
[![NPM downloads badge](https://img.shields.io/npm/d18m/astro-html-minifier-next?style=for-the-badge&label=NPM%20Downloads&labelColor=2a2d35&color=e13fa0&cacheSeconds=86400)][package-on-npm]
[![JSR score badge](https://jsr.io/badges/@jonasgeiler/astro-html-minifier-next/score?style=for-the-badge&label=Score&logoColor=fff&labelColor=2a2d35&color=f2ebf4&cacheSeconds=86400)][package-on-jsr]
[![Minified size (gzip) badge](https://img.shields.io/bundlejs/size/astro-html-minifier-next?style=for-the-badge&labelColor=2a2d35&color=e13fa0&cacheSeconds=86400)][package-on-bundlejs]

```typescript
import { defineConfig } from "astro/config";
import htmlMinifier from "astro-html-minifier-next";

export default defineConfig({
  integrations: [
    htmlMinifier({
      /* My recommended html-minifier-next options: */
      caseSensitive: true,
      collapseBooleanAttributes: true,
      collapseInlineTagWhitespace: true,
      collapseWhitespace: true,
      conservativeCollapse: false,
      continueOnParseError: false,
      decodeEntities: true,
      html5: true,
      includeAutoGeneratedTags: true,
      keepClosingSlash: false,
      log: (msg) => { if (msg instanceof Error) throw msg },
      minifyCSS: { errorRecovery: false },
      minifyJS: true,
      minifyURLs: false,
      noNewlinesBeforeTagClose: false,
      preserveLineBreaks: false,
      preventAttributesEscaping: false,
      processConditionalComments: false,
      removeAttributeQuotes: false, // The HTML specification recommends to always use quotes, but technically they are optional in some cases.
      removeComments: true,
      removeEmptyAttributes: true,
      removeEmptyElements: false,
      removeOptionalTags: true,
      removeRedundantAttributes: true,
      removeScriptTypeAttributes: true,
      removeStyleLinkTypeAttributes: true,
      removeTagWhitespace: false,
      sortAttributes: false,
      sortClassName: false,
      useShortDoctype: true,
    }),
  ],
});
```

## Installation

Add the integration to your Astro project using the `astro add` command.  
This will install the package and make the appropriate changes to your
`astro.config.mjs`/`astro.config.ts` file in one step:
```bash
npx astro add astro-html-minifier-next
```
If you prefer to install the integration manually instead, complete the
following two steps:
1. Install the integration to your project’s dependencies using your preferred
   package manager.  
   If you’re using npm or aren’t sure, run this in the terminal:
   ```bash
   npm install --save-dev astro-html-minifier-next
   ```
   Or, if you're using Deno, run this in the terminal:
   ```bash
   deno add jsr:@jonasgeiler/astro-html-minifier-next
   ```
2. Add the integration to your `astro.config.mjs`/`astro.config.ts` file:
   ```typescript
   import { defineConfig } from "astro/config";
   
   // ADD THE FOLLOWING LINE:
   import htmlMinifier from "astro-html-minifier-next";

   export default defineConfig({
     // ...
   
     integrations: [
       // ...
   
       // ADD THE FOLLOWING LINE:
       htmlMinifier({ /* Your html-minifier-next options here. */ }),
     ],
   });
   ```

## Usage

Once installed, the integration will automatically minify all HTML assets
generated by Astro during the build process using the provided
[html-minifier-next][html-minifier-next] options.

### Options

You can find a quick reference of all available options in the
[html-minifier-next documentation][html-minifier-next-options].  
You can also check out the
[JSDoc comments in the source code][html-minifier-next-options-source].

> [!TIP]
> To ensure consistent and optimal browser support throughout your project,
> I recommend setting the `targets` property of the `minifyCSS` option to your
> project's [Browserslist][browserslist] query.
> This configures [Lightning CSS][lightningcss] (the CSS minifier used by
> [html-minifier-next][html-minifier-next]) to properly optimize the CSS
> according to the browsers you want to support.
> 
> You can do this, by adding the following lines to your
> `astro.config.mjs`/`astro.config.ts` file:
> ```typescript
> import { defineConfig } from "astro/config";
> import htmlMinifier from "astro-html-minifier-next";
> 
> // ADD THE FOLLOWING LINES:
> import browserslist from "browserslist";
> import { browserslistToTargets } from "lightningcss";
> 
> export default defineConfig({
>   // ...
> 
>   integrations: [
>     // ...
> 
>     htmlMinifier({
>       // ...
> 
>       minifyCSS: {
>         // ...
> 
>         // ADD THE FOLLOWING LINE:
>         targets: browserslistToTargets(browserslist("defaults")),
>       },
>     }),
>   ],
> });
> ```
> 
> More information can be found in the [Lightning CSS documentation][lightningcss-docs].

## Credits

This integration wouldn't be possible without the awesome work of
[Juriy Zaytsev aka. @kangax][@kangax] ([html-minifier][html-minifier]),
[the Terser team][@terser] ([html-minifier-terser][html-minifier-terser]), and
of course [Jens Oliver Meiert aka. @j9t][@j9t] ([html-minifier-next][html-minifier-next]).

[astro]: https://astro.build/
[html-minifier-next]: https://www.npmjs.com/package/html-minifier-next
[html-minifier-next-options]: https://www.npmjs.com/package/html-minifier-next#options-quick-reference
[html-minifier-next-options-source]: https://github.com/j9t/html-minifier-next/blob/ba95daa75dfec6e3c6bb8bd1b0af3ad84e596e61/src/htmlminifier.js#L1482
[latest-release]: https://github.com/jonasgeiler/astro-html-minifier-next/releases/latest
[package-on-bundlejs]: https://bundlejs.com/?q=astro-html-minifier-next
[package-on-jsr]: https://jsr.io/@jonasgeiler/astro-html-minifier-next
[package-on-npm]: https://www.npmjs.com/package/astro-html-minifier-next
[browserslist]: https://browsersl.ist/
[lightningcss]: https://lightningcss.dev/
[lightningcss-docs]: https://lightningcss.dev/docs.html#with-vite
[@kangax]: https://github.com/kangax
[html-minifier]: https://github.com/kangax/html-minifier
[@terser]: https://github.com/terser
[html-minifier-terser]: https://github.com/terser/html-minifier-terser
[@j9t]: https://github.com/j9t
